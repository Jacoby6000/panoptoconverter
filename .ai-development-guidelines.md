# Internal Development Guidelines (PanoptoConverter)

These guidelines capture decisions and best practices for building PanoptoConverter. Aim for reusable, modern components and a DRY codebase.

## Architecture & Principles

- Prefer small, focused Svelte components with clear inputs/outputs (props, events).
- Keep business logic (exporting, projections, decoding) separate from UI components.
- Use TypeScript everywhere; enable strict checking and narrow types aggressively.
- DRY: extract shared logic to `src/lib` modules or stores; avoid duplicating UI patterns.
- Accessibility: keyboard navigable, labeled controls, visible focus states, ARIA where needed.

## State Management

- Use Svelte stores for cross-component state:
  - `videoStore`: source file, metadata, duration, currentTime, playback state.
  - `projectionStore`: input type (equirectangular/stereo), field-of-view, angles (yaw/pitch/roll).
  - `exportStore`: fps, aspect ratio, resolution, range, job status/progress.
- Keep stores serializable; avoid storing DOM nodes or large binary blobs directly when possible.

## File/Folder Structure

- `src/lib/components/`: UI components (Player, AnglePreview, DropZone, Controls, ExportPanel).
- `src/lib/stores/`: Svelte stores and types.
- `src/lib/core/`: core logic (projection math, sampling, rendering, exporters, workers).
- `src/lib/utils/`: small pure utilities.
- `src/assets/`: static assets.

## Naming & Types

- Prefer explicit names: `exportFrameSequence`, `parseEquirectMetadata`.
- Define domain types in `src/lib/types.ts` (e.g., `AnglePreset`, `AspectRatio`, `Resolution`).
- Use branded/opaque types for units where helpful (degrees vs radians).

## UI/UX

- Modern, minimal UI. Group related controls. Provide sensible defaults.
- Drag-and-drop area plus a prominent “Open file” button.
- Timeline scrubbing: show current time, allow click/drag. Keyboard shortcuts (J/K/L, arrows) where possible.
- Angle preview grid: show each configured angle as a live thumbnail; clicking focuses it.

## Performance

- Offload heavy frame sampling/exporting to Web Workers.
- Use WebGL/WebGPU or OffscreenCanvas if needed for projection and sampling.
- Avoid layout thrash; batch state updates; prefer derived stores for computed values.

## Export

- Deterministic sampling at N fps across a time range. Handle edge frames gracefully.
- Allow cancelation; surface progress (0–100%) and ETA when possible.
- Output: client-side zip (optional) or file-per-download; respect resolution/aspect.

## Testing & QA

- Unit-test core math/projection and frame indexing. Light snapshot tests for UI.
- Manual QA checklist: load file, scrub, add angles, preview, export small range, cancel.

## Dependencies

- Keep dependencies minimal. Prefer native browser APIs.
- If pulling in heavy libs (e.g., gl-matrix), justify with performance/maintenance benefits.

## Code Style

- Match existing formatting. Keep components short. Extract sub-components early.
- Comments are scarce; add only where intent isn’t obvious.

## Review

- PRs must describe user-visible changes and risks. Include before/after screenshots for UI.
